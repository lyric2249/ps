www.{$PUBLIC_HOST} {
  redir https://{$PUBLIC_HOST}{uri} 308
}

{$PUBLIC_HOST} {
  @ss_root path /ss
  redir @ss_root /ss/ 308

  # 반드시 handle_path: /ss 프리픽스를 "제거"해서 백엔드로 보냄
  handle_path /ss/* {
    reverse_proxy superset:8088 {
      header_up X-Forwarded-Proto {scheme}
      header_up X-Forwarded-Host {host}
      header_up X-Forwarded-Port {server_port}
      header_up X-Forwarded-Prefix /ss   # ← 외부 베이스 경로를 알려줌
      header_up Host {host}
    }
  }

  respond "OK" 200
}
